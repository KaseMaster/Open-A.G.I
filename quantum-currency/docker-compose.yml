version: '3.8'

services:
  # MiningAgent Service
  mining-agent:
    build:
      context: .
      dockerfile: Dockerfile.mining-agent
    container_name: quantum-mining-agent
    restart: unless-stopped
    environment:
      - PYTHONPATH=/app/src
      - LOG_LEVEL=INFO
    volumes:
      - ./logs:/var/log/quantum
      - ./data:/var/lib/quantum
    networks:
      - quantum-network
    depends_on:
      - prometheus
      - agi-coordinator

  # CAL Engine Service
  cal-engine:
    build:
      context: .
      dockerfile: Dockerfile.cal-engine
    container_name: quantum-cal-engine
    restart: unless-stopped
    environment:
      - PYTHONPATH=/app/src
      - CAL_ENGINE_PORT=8080
    ports:
      - "8080:8080"
    volumes:
      - ./logs:/var/log/quantum
      - ./checkpoints:/app/checkpoints
    networks:
      - quantum-network
    depends_on:
      - agi-coordinator

  # Governance Service
  governance:
    build:
      context: .
      dockerfile: Dockerfile.governance
    container_name: quantum-governance
    restart: unless-stopped
    environment:
      - PYTHONPATH=/app/src
      - GOVERNANCE_PORT=8081
    ports:
      - "8081:8081"
    volumes:
      - ./data:/var/lib/quantum
    networks:
      - quantum-network
    depends_on:
      - agi-coordinator

  # ZKP Ledger Service
  zkp-ledger:
    build:
      context: .
      dockerfile: Dockerfile.zkp-ledger
    container_name: quantum-zkp-ledger
    restart: unless-stopped
    environment:
      - PYTHONPATH=/app/src
      - ZKP_PORT=8082
    ports:
      - "8082:8082"
    volumes:
      - ./data:/var/lib/quantum
    networks:
      - quantum-network
    depends_on:
      - agi-coordinator

  # Open AGI Coordinator Service
  agi-coordinator:
    build:
      context: .
      dockerfile: Dockerfile.agi-coordinator
    container_name: quantum-agi-coordinator
    restart: unless-stopped
    environment:
      - PYTHONPATH=/app/src
      - AGI_PORT=8083
    ports:
      - "8083:8083"
    volumes:
      - ./logs:/var/log/quantum
    networks:
      - quantum-network

  # Verification Loop Service
  verification-loop:
    build:
      context: .
      dockerfile: Dockerfile.verification
    container_name: quantum-verification-loop
    restart: unless-stopped
    environment:
      - PYTHONPATH=/app/src
    volumes:
      - ./logs:/var/log/quantum
      - ./reports:/var/log/quantum/reports
    networks:
      - quantum-network
    depends_on:
      - mining-agent
      - cal-engine
      - governance
      - zkp-ledger
      - agi-coordinator

  # HMN Node 1
  hmn-node-1:
    build:
      context: .
      dockerfile: Dockerfile.hmn-node
    container_name: hmn-node-1
    restart: unless-stopped
    environment:
      - PYTHONPATH=/app/src
      - NODE_ID=hmn-node-1
    ports:
      - "8001:8001"
      - "8002:8002"
      - "8003:8003"
      - "8004:8004"
      - "8005:8005"
    volumes:
      - ./hmn-data/node1:/app/data
      - ./logs:/var/log/quantum
    networks:
      - quantum-network
    depends_on:
      - agi-coordinator

  # HMN Node 2
  hmn-node-2:
    build:
      context: .
      dockerfile: Dockerfile.hmn-node
    container_name: hmn-node-2
    restart: unless-stopped
    environment:
      - PYTHONPATH=/app/src
      - NODE_ID=hmn-node-2
    ports:
      - "8011:8001"
      - "8012:8002"
      - "8013:8003"
      - "8014:8004"
      - "8015:8005"
    volumes:
      - ./hmn-data/node2:/app/data
      - ./logs:/var/log/quantum
    networks:
      - quantum-network
    depends_on:
      - agi-coordinator

  # Prometheus Monitoring
  prometheus:
    image: prom/prometheus:latest
    container_name: quantum-prometheus
    restart: unless-stopped
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    networks:
      - quantum-network

  # Grafana Dashboard
  grafana:
    image: grafana/grafana:latest
    container_name: quantum-grafana
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - grafana_data:/var/lib/grafana
      - ./grafana/provisioning:/etc/grafana/provisioning
    networks:
      - quantum-network
    depends_on:
      - prometheus

  # Alert Manager
  alertmanager:
    image: prom/alertmanager:latest
    container_name: quantum-alertmanager
    restart: unless-stopped
    ports:
      - "9093:9093"
    volumes:
      - ./alertmanager:/etc/alertmanager
    networks:
      - quantum-network
    depends_on:
      - prometheus

networks:
  quantum-network:
    driver: bridge

volumes:
  prometheus_data:
  grafana_data: